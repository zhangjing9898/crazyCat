var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var a in e)e.hasOwnProperty(a)&&(t[a]=e[a]);i.prototype=e.prototype,t.prototype=new i},__awaiter=this&&this.__awaiter||function(t,e,i,a){return new(i||(i=Promise))(function(n,r){function o(t){try{h(a.next(t))}catch(e){r(e)}}function s(t){try{h(a["throw"](t))}catch(e){r(e)}}function h(t){t.done?n(t.value):new i(function(e){e(t.value)}).then(o,s)}h((a=a.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){function i(t){return function(e){return a([t,e])}}function a(i){if(n)throw new TypeError("Generator is already executing.");for(;h;)try{if(n=1,r&&(o=r[2&i[0]?"return":i[0]?"throw":"next"])&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[0,o.value]),i[0]){case 0:case 1:o=i;break;case 4:return h.label++,{value:i[1],done:!1};case 5:h.label++,r=i[1],i=[0];continue;case 7:i=h.ops.pop(),h.trys.pop();continue;default:if(o=h.trys,!(o=o.length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){h=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){h.label=i[1];break}if(6===i[0]&&h.label<o[1]){h.label=o[1],o=i;break}if(o&&h.label<o[2]){h.label=o[2],h.ops.push(i);break}o[2]&&h.ops.pop(),h.trys.pop();continue}i=e.call(t,h)}catch(a){i=[6,a],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}var n,r,o,s,h={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:i(0),"throw":i(1),"return":i(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s},BaseScene=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(egret.Event.ADDED_TO_STAGE,e.initView,e),e}return __extends(e,t),e.prototype.initView=function(){},e}(egret.DisplayObjectContainer);__reflect(BaseScene.prototype,"BaseScene");var Point=function(){function t(t,e){this.x=0,this.y=0,this.x=t,this.y=e}return t.prototype.equal=function(t){return t&&t.x===this.x&&t.y===this.y},t.prototype.copy=function(){return new t(this.x,this.y)},t}();__reflect(Point.prototype,"Point");var OverType;!function(t){t[t.NULL=-1]="NULL",t[t.PLAYER=0]="PLAYER",t[t.CAT=1]="CAT"}(OverType||(OverType={}));var PlayScene=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initView=function(){this.sound=RES.getRes("go_mp3"),this.catRunning=!1,this.createGridNode(),this.createBarrier(n.GameData.barrierNumber),this.createCat(),this.x=(GameUtil.getStageWidth()-this.width)/2,this.y=GameUtil.getStageHeight()/2.5,SceneController.showLevelTip()},e.prototype.createGridNode=function(){n.GameData.gridNodeList=new Array(n.GameData.row);for(var t=GameUtil.getStageWidth()/(n.GameData.row+1)-n.GameData.gridMargin,e=0;e<n.GameData.row;++e){n.GameData.gridNodeList[e]=new Array(n.GameData.col);for(var i=e%2*(t/2),a=0;a<n.GameData.col;++a){var r=i+a*(t+n.GameData.gridMargin),o=e*t;n.GameData.gridNodeList[e][a]=new GridNode(new Point(e,a),new Point(r,o),t,this),n.GameData.gridNodeList[e][a].setStatus(GridNodeStatus.AVAILABLE),this.addChild(n.GameData.gridNodeList[e][a])}}},e.prototype.createBarrier=function(t){for(;t;){var e=Math.floor(100*Math.random()%n.GameData.row),i=Math.floor(100*Math.random()%n.GameData.col),a=n.GameData.gridNodeList[e][i];e!==Math.floor(n.GameData.row/2)&&i!==Math.floor(n.GameData.col/2)&&a.getStatus()===GridNodeStatus.AVAILABLE&&(a.setStatus(GridNodeStatus.UNAVAILABLE),t--)}},e.prototype.createCat=function(){var t=Math.floor(n.GameData.row/2),e=Math.floor(n.GameData.col/2);this.cat=new Cat(this),this.addChild(this.cat),this.cat.move(new Point(t,e))},e.prototype.catRun=function(t){t.hasPath||this.cat.setStatus(CatStatus.UNAVAILABLE);var e=t.nextStep;return e.equal(this.cat.getIndex())?void this.gameOver(OverType.PLAYER):(this.cat.move(e),(e.x*e.y===0||e.x===n.GameData.row-1||e.y===n.GameData.col-1)&&this.gameOver(OverType.CAT),void(this.catRunning=!1))},e.prototype.playerRun=function(t){this.sound.play(0,1),n.GameData.step++,this.catRunning=!0,this.cat.run()},e.prototype.canRun=function(){return!this.catRunning},e.prototype.gameOver=function(t){n.GameData.overType=t,SceneController.showEndScene()},e}(BaseScene);__reflect(PlayScene.prototype,"PlayScene",["PlayListener"]);var CatStatus;!function(t){t[t.AVAILABLE=0]="AVAILABLE",t[t.UNAVAILABLE=1]="UNAVAILABLE"}(CatStatus||(CatStatus={}));var RunPath=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.step=0,e}return __extends(e,t),e.prototype.copy=function(){var t=new e(this.x,this.y);return t.step=this.step,t.firstStep=this.firstStep.copy(),t},e}(Point);__reflect(RunPath.prototype,"RunPath");var SearchResult=function(){function t(){this.hasPath=!0}return t}();__reflect(SearchResult.prototype,"SearchResult");var Cat=function(t){function e(e){var i=t.call(this)||this;return i.catMovieClip={normal:GameUtil.createMovieClipByName("cat_normal"),loser:GameUtil.createMovieClipByName("cat_loser")},i.playListener=e,i.addEventListener(egret.Event.ADDED_TO_STAGE,i.onAddToStage,i),i}return __extends(e,t),e.prototype.run=function(){this.playListener&&this.playListener.catRun(this.search())},e.prototype.search=function(){for(var t=new Array(n.GameData.row),e=0;e<n.GameData.row;++e){t[e]=new Array(n.GameData.col);for(var i=0;i<n.GameData.col;++i)t[e][i]=Number.MAX_VALUE}var a=this.getFirstStep(),r=new Array;a.forEach(function(e){t[e.x][e.y]=1,r.push(e.copy())});for(var o=Number.MAX_VALUE,s=new Array;r.length;){var h=r.shift();if(0!==h.x&&0!==h.y&&h.x!==n.GameData.row-1&&h.y!==n.GameData.col-1)for(var c=this.getDir(h.x),e=0;e<c.length;++e){var l=new RunPath(h.x,h.y);l.x+=c[e][0],l.y+=c[e][1],l.step=h.step+1,l.x<0||l.y<0||l.x===n.GameData.row||l.y===n.GameData.col||n.GameData.gridNodeList[l.x][l.y].getStatus()===GridNodeStatus.AVAILABLE&&t[l.x][l.y]>l.step&&(t[l.x][l.y]=l.step,l.firstStep=h.firstStep.copy(),r.push(l))}else h.step<o?(s=new Array,s.push(h.firstStep.copy()),o=h.step):h.step===o&&s.push(h.firstStep.copy())}var u=new SearchResult;if(o===Number.MAX_VALUE&&(this.setStatus(CatStatus.UNAVAILABLE),u.hasPath=!1),0===s.length&&a.forEach(function(t){s.push(t.firstStep)}),s.length>0){var d=this.sortList(s),p=Math.floor(Math.random()*d.length);u.nextStep=d[p]}else u.nextStep=this.index;return u},e.prototype.sortList=function(t){var e=new Array;t.forEach(function(t){for(var i=t.x+"-"+t.y,a=-1,n=0;n<e.length;++n)if(e[n].key===i){a=n;break}a>-1?e[a].count++:e.push({key:i,value:t,count:1})}),e.sort(function(t,e){return e.count-t.count});var i=new Array;return e.forEach(function(t){t.count===e[0].count&&i.push(new Point(t.value.x,t.value.y))}),i},e.prototype.onAddToStage=function(t){this.init()},e.prototype.init=function(){this.bg=new egret.MovieClip,console.log("cat.ts中的bg",this.bg),this.addChild(this.bg),this.setStatus(CatStatus.AVAILABLE)},e.prototype.getFirstStep=function(){for(var t=new Array,e=this.getDir(this.index.x),i=0;i<e.length;++i){var a=this.index.x+e[i][0],r=this.index.y+e[i][1];if(!(0>a||0>r||a>=n.GameData.row||r>=n.GameData.col)&&n.GameData.gridNodeList[a][r].getStatus()===GridNodeStatus.AVAILABLE){var o=new RunPath(a,r);o.step=1,o.firstStep=new Point(a,r),t.push(o)}}return t},e.prototype.getDir=function(t){var e=t%2,i=[[0,-1],[0,1],[-1,e-1],[-1,1*e],[1,e-1],[1,1*e]];return i},e.prototype.setStatus=function(t){this.status!==t&&(this.status=t,this.changBg())},e.prototype.getIndex=function(){return this.index},e.prototype.changBg=function(){switch(this.status){case CatStatus.AVAILABLE:this.bg.movieClipData=this.catMovieClip.normal.movieClipData,this.bg.play(-1);break;case CatStatus.UNAVAILABLE:this.bg.movieClipData=this.catMovieClip.loser.movieClipData,this.bg.play(-1)}},e.prototype.move=function(t){void 0===t&&(t=this.index),t.equal(this.index)||(this.gridNode&&this.gridNode.setStatus(GridNodeStatus.AVAILABLE),this.gridNode=n.GameData.gridNodeList[t.x][t.y],this.gridNode.setStatus(GridNodeStatus.CAT),this.index=t,this.x=this.gridNode.x+(this.gridNode.width-this.bg.width)/2,console.log("cat move",this.gridNode.x,this.gridNode.width,this.bg.width),this.y=this.gridNode.y-this.bg.height+this.gridNode.height/2)},e}(egret.Sprite);__reflect(Cat.prototype,"Cat");var n;!function(t){var e=function(){function t(){}return t.level=0,t.levelData=[{barrierNumber:26,row:7,col:7},{barrierNumber:22,row:8,col:8},{barrierNumber:24,row:9,col:9},{barrierNumber:26,row:10,col:10},{barrierNumber:24,row:10,col:10},{barrierNumber:22,row:10,col:10},{barrierNumber:20,row:10,col:10},{barrierNumber:18,row:10,col:10},{barrierNumber:16,row:10,col:10},{barrierNumber:14,row:10,col:10}],t.overType=OverType.NULL,t.step=0,t.barrierNumber=15,t.row=6,t.col=6,t.gridMargin=10,t}();t.GameData=e,__reflect(e.prototype,"n.GameData")}(n||(n={}));var SceneController=function(){function t(){this.startScene=new StartScene,this.playScene=new PlayScene,this.endScene=new EndScene}return Object.defineProperty(t,"instance",{get:function(){return this.sceneController||(this.sceneController=new t),this.sceneController},enumerable:!0,configurable:!0}),t.prototype.setStage=function(t){this._stage=t},t.initGame=function(){var t=this.instance._stage;this.instance.playScene.parent&&(t.removeChild(this.instance.playScene),this.instance.playScene=new PlayScene),this.instance.endScene.parent&&(t.removeChild(this.instance.endScene),this.instance.endScene=new EndScene),t.addChild(this.instance.startScene)},t.showPlayScene=function(){var t=this.instance._stage;this.instance.startScene.parent&&(t.removeChild(this.instance.startScene),this.instance.startScene=new StartScene),this.instance.playScene.parent&&(t.removeChild(this.instance.playScene),this.instance.playScene=new PlayScene),this.instance.endScene.parent&&(t.removeChild(this.instance.endScene),this.instance.endScene=new EndScene);var e=n.GameData.level;e>=n.GameData.levelData.length&&(e=n.GameData.levelData.length-1),n.GameData.barrierNumber=n.GameData.levelData[e].barrierNumber,n.GameData.row=n.GameData.levelData[e].row,n.GameData.col=n.GameData.levelData[e].col,n.GameData.step=0,n.GameData.overType=OverType.NULL,console.log("进入showPlayScene"),t.addChild(this.instance.playScene)},t.showLevelTip=function(){var t=n.GameData.level+1,e=this.instance._stage,i=new egret.DisplayObjectContainer;i.width=GameUtil.getStageWidth(),i.height=GameUtil.getStageHeight(),i.x=0,i.y=0,e.addChild(i);var a=new egret.Shape;a.graphics.beginFill(0,.8),a.graphics.drawRect(0,0,GameUtil.getStageWidth(),GameUtil.getStageHeight()),a.graphics.endFill(),a.touchEnabled=!0,i.addChild(a);var r=new egret.TextField;r.bold=!0,r.textColor=16777215,r.strokeColor=0,r.stroke=2,r.size=60,r.text="第"+t+"关",r.x=(GameUtil.getStageWidth()-r.width)/2,r.y=(GameUtil.getStageHeight()-r.height)/2,i.addChild(r),egret.Tween.get(r).wait(500).to({y:10,alpha:0},1e3,egret.Ease.backInOut).call(function(){e.removeChild(i)}),egret.Tween.get(a).wait(500).to({alpha:0},1e3,egret.Ease.sineIn)},t.showEndScene=function(){var t=this.instance._stage;t.addChild(this.instance.endScene)},t}();__reflect(SceneController.prototype,"SceneController");var Main=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(e,t),e.prototype.onAddToStage=function(t){egret.lifecycle.addLifecycleListener(function(t){t.onUpdate=function(){}}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()},this.runGame()["catch"](function(t){console.log(t)})},e.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.loadResource()];case 1:return t.sent(),this.createGameScene(),[2]}})})},e.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(i){switch(i.label){case 0:return i.trys.push([0,3,,4]),t=new LoadingUI,this.stage.addChild(t),[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return i.sent(),[4,RES.loadGroup("preload",0,t)];case 2:return i.sent(),this.stage.removeChild(t),[3,4];case 3:return e=i.sent(),console.error(e),[3,4];case 4:return[2]}})})},e.prototype.createGameScene=function(){var t=new egret.DisplayObjectContainer;this.addChild(t);var e=GameUtil.createBitmapByName("bg","jpg");t.addChild(e);var i=GameUtil.getStageWidth()/e.width,a=GameUtil.getStageHeight()/e.height,n=e.width/e.height;i>a?(e.width=GameUtil.getStageWidth(),e.height=e.width/n):(e.height=GameUtil.getStageHeight(),e.width=e.height*n),e.x=(GameUtil.getStageWidth()-e.width)/2,SceneController.instance.setStage(t),SceneController.initGame()},e.prototype.createBitmapByName=function(t){var e=new egret.Bitmap,i=RES.getRes(t);return e.texture=i,e},e}(egret.DisplayObjectContainer);__reflect(Main.prototype,"Main");var GridNodeStatus;!function(t){t[t.AVAILABLE=0]="AVAILABLE",t[t.UNAVAILABLE=1]="UNAVAILABLE",t[t.CAT=2]="CAT"}(GridNodeStatus||(GridNodeStatus={}));var GridNode=function(t){function e(e,i,a,n){var r=t.call(this)||this;return r.gridBg={white:GameUtil.createBitmapByName("grid_white"),yellow:GameUtil.createBitmapByName("grid_yellow")},r.bg=new egret.Bitmap,r.index=e,r.size=a,r.bg.width=a,r.bg.height=a,r.pos=i,r.playListener=n,r.addEventListener(egret.Event.ADDED_TO_STAGE,r.onAddToStage,r),r}return __extends(e,t),e.prototype.setStatus=function(t){this.status=t,this.changeBg()},e.prototype.getStatus=function(){return this.status},e.prototype.onAddToStage=function(t){this.init()},e.prototype.init=function(){this.touchEnabled=!0,this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.touch,this),this.addChild(this.bg),this.x=this.pos.x,this.y=this.pos.y},e.prototype.touch=function(){this.playListener&&this.playListener.canRun()&&this.status===GridNodeStatus.AVAILABLE&&(this.setStatus(GridNodeStatus.UNAVAILABLE),this.playListener.playerRun(this.index))},e.prototype.changeBg=function(){switch(this.status){case GridNodeStatus.AVAILABLE:this.bg.texture=this.gridBg.white.texture;break;case GridNodeStatus.UNAVAILABLE:this.bg.texture=this.gridBg.yellow.texture;break;case GridNodeStatus.CAT:this.bg.texture=this.gridBg.white.texture}},e}(egret.Sprite);__reflect(GridNode.prototype,"GridNode");var LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.createView(),e}return __extends(e,t),e.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.width=480,this.textField.height=100,this.textField.x=(GameUtil.getStageWidth()-this.textField.width)/2,this.textField.y=(GameUtil.getStageHeight()-this.textField.height)/2,this.textField.textAlign="center",this.textField.text="Loading...0%"},e.prototype.onProgress=function(t,e){var i=100*t/e;this.textField.text="Loading..."+i.toFixed(0)+"%"},e}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var DebugPlatform=function(){function t(){}return t.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,{nickName:"username"}]})})},t.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);var EndScene=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initView=function(){var t=new egret.Shape;switch(t.graphics.beginFill(0,.8),t.graphics.drawRect(0,0,GameUtil.getStageWidth(),GameUtil.getStageHeight()),t.graphics.endFill(),t.touchEnabled=!0,this.addChild(t),n.GameData.overType){case OverType.PLAYER:console.log("玩家赢"),this.initPlayerWin();break;case OverType.CAT:console.log("猫猫赢"),this.initCatWin()}},e.prototype.initPlayerWin=function(){var t=GameUtil.createBitmapByName("end_tip_success");this.addChild(t),t.x=(GameUtil.getStageWidth()-t.width)/2,t.y=(GameUtil.getStageHeight()-t.height)/2;var e=new egret.TextField;e.bold=!0,e.textColor=16777215,e.strokeColor=0,e.stroke=2,e.text="您花了"+n.GameData.step+"步抓住了神经猫",e.x=(t.width-e.width)/2+t.x,e.y=(t.height-e.height)/2+t.y+50,console.log("endScene initPlayerWin中info的x和y",e.x,e.y),this.addChild(e);var i=RES.getRes("success_mp3");i.play(0,1);var a=GameUtil.createBitmapByName("btn_next");this.addChild(a),a.x=(GameUtil.getStageWidth()-a.width)/2,a.y=t.y+t.height,GameUtil.bitmapToBtn(a,function(){console.log("进入下一关"),n.GameData.level++,SceneController.showPlayScene()})},e.prototype.initCatWin=function(){var t=GameUtil.createBitmapByName("end_tip_fail");this.addChild(t),t.x=(GameUtil.getStageWidth()-t.width)/2,t.y=(GameUtil.getStageHeight()-t.height)/2;var e=new egret.TextField;e.bold=!0,e.textColor=16777215,e.strokeColor=0,e.stroke=2,e.lineSpacing=10,e.text="您坚持了"+n.GameData.level+"关\n还是让神经猫逃跑了！！！",e.x=(t.width-e.width)/2+t.x,e.y=(t.height-e.height)/2+t.y+50,this.addChild(e);var i=RES.getRes("fail_mp3");i.play(0,1);var a=GameUtil.createBitmapByName("btn_back");this.addChild(a),a.x=(GameUtil.getStageWidth()-a.width)/2-a.width/2,a.y=t.y+t.height,GameUtil.bitmapToBtn(a,function(){console.log("返回首页"),n.GameData.level=0,SceneController.initGame()});var r=GameUtil.createBitmapByName("btn_replay");this.addChild(r),r.x=(GameUtil.getStageWidth()-r.width)/2+r.width/2,r.y=t.y+t.height,GameUtil.bitmapToBtn(r,function(){console.log("重新开始"),n.GameData.level=0,SceneController.showPlayScene()})},e}(BaseScene);__reflect(EndScene.prototype,"EndScene");var GameUtil=function(){function t(){}return t.getStageHeight=function(){return egret.MainContext.instance.stage.stageHeight},t.getStageWidth=function(){return egret.MainContext.instance.stage.stageWidth},t.createBitmapByName=function(t,e){void 0===e&&(e="png");var i=new egret.Bitmap,a=RES.getRes(t+"_"+e);return i.texture=a,i},t.createMovieClipByName=function(t){var e=RES.getRes(t+"_json"),i=RES.getRes(t+"_png"),a=new egret.MovieClipDataFactory(e,i);return new egret.MovieClip(a.generateMovieClipData(t))},t.bitmapToBtn=function(t,e){function i(){t.scaleX=1,t.scaleY=1}t.touchEnabled=!0,t.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){t.scaleX=.95,t.scaleY=.95},this),t.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){i(),e&&e()},this),t.addEventListener(egret.TouchEvent.TOUCH_CANCEL,i,this),t.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,i,this),t.addEventListener(egret.TouchEvent.TOUCH_END,i,this)},t}();__reflect(GameUtil.prototype,"GameUtil");var StartScene=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initView=function(){var t=GameUtil.createBitmapByName("cat_start_bg");this.addChild(t),t.x=(GameUtil.getStageWidth()-t.width)/2,t.y=(GameUtil.getStageHeight()-t.height)/2+100;var e=GameUtil.createBitmapByName("btn_start");this.addChild(e),e.x=(GameUtil.getStageWidth()-e.width)/2,e.y=t.y+t.height,GameUtil.bitmapToBtn(e,function(){console.log("开始游戏"),n.GameData.level=0,SceneController.showPlayScene()})},e}(BaseScene);__reflect(StartScene.prototype,"StartScene");